<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>자판기</title>
    <link href="./index4.css" rel="stylesheet" type="text/css" />
    <!--  부트스트랩 CDN 링크 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      th,
      td {
        border: 1px solid rgb(220 38 38);
        padding: 10px;
      }
      td {
        font-weight: 400;
      }
    </style>
  </head>
  <body>
    <div class="w-1/2 m-auto mt-3 p-4 border border-4 border-black bg-red-700">
      <h2
        class="bg-white text-center p-2 rounded-t-lg title mb-3"
        th:text="|* #{page.title} *|"
      ></h2>
      <div class="flex justify-between items-center mb-3">
        <div
          class="p-2 bg-white text-red-700 text-center rounded-r-lg"
          th:text="|▽ #{page.listName}|"
        >
          ▽ 자판기 상품 목록
        </div>
        <!-- 언어 선택 -->
        <fieldset>
          <label class="toggleLabel">
            <span class="toggleFont">한글</span>
            <input
              role="switch"
              type="checkbox"
              id="changeToEng"
              class="languageToggle"
            />
            <span class="toggleFont">ENG</span>
          </label>
        </fieldset>
        <!-- 코인 모양 -->
        <div class="coinSlot rounded-pill">
          <div class="coin"></div>
        </div>
      </div>
      <div class="bg-white text-center font-semibold mb-3 p-3">
        <span
          th:if="${#lists.isEmpty(productList)}"
          th:text="#{page.noList}"
        ></span>
        <table
          th:if="${!#lists.isEmpty(productList)}"
          class="border border-red-600 w-full"
        >
          <thead>
            <tr>
              <th class="text-red-600" th:text="#{page.list.no}"></th>
              <th th:text="#{page.list.name}">상품명</th>
              <th th:text="#{page.list.price}">가격</th>
              <th th:text="#{page.list.limitDate}">유통기한</th>
              <th th:text="#{page.list.update}">수정</th>
              <th th:text="#{page.list.delete}">삭제</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="product, i: ${productList}">
              <td class="font-semibold" th:text="${i.count}"></td>
              <td th:text="${product.name}"></td>
              <td th:text="${product.price}"></td>
              <td th:text="${product.limit_date}"></td>
              <td class="p-1.5">
                <a
                  class="bg-blue-500 py-2 px-3 text-white border border-none rounded-md font-semibold"
                  th:href="|/update?index=${i.index}|"
                  th:text="#{page.list.update}"
                ></a>
              </td>
              <td class="p-1.5">
                <button
                  id="delBtn"
                  th:pId="${i.index}"
                  onclick="deleteItem(this.getAttribute('pId'))"
                  class="bg-red-500 py-2 px-3 text-white border border-none rounded-md font-semibold"
                  th:text="#{page.list.delete}"
                ></button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex justify-end">
        <p
          class="w-52 bg-white text-center text-red-700 mb-3 px-2 py-1 rounded-l-lg"
          th:utext="'▲ ' + #{page.list.count1} + ' <span class=\'text-black\'>' + ${productLen}+'</span> ' + #{page.list.count2}"
        ></p>
      </div>
      <div class="flex justify-center">
        <a
          class="bg-red-500 text-white text-center w-25 px-3 py-2 font-semibold rounded-md cursor-pointer"
          th:href="@{/add}"
          th:text="#{page.button.add}"
        ></a>
      </div>
    </div>
    <script>
      const checkBtn = document.getElementById("changeToEng");
      console.log();
      if (sessionStorage.getItem("lang") === "en") checkBtn.checked = true;
      else checkBtn.checked = false;

      checkBtn.addEventListener("click", function () {
        fetch("http://localhost:8080/api/v1/changeLocale")
          .then((res) => res.text())
          .then((data) => {
            if (data === "en") {
              checkBtn.checked = true;
              sessionStorage.setItem("lang", "en");
            } else {
              checkBtn.checked = false;
              sessionStorage.setItem("lang", "ko");
            }
            location.reload();
          });
      });

      function deleteItem(id) {
        fetch(`http://localhost:8080/api/v1/delete?index=${id}`)
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            if (data.status === "ok") {
              alert(data.message);
              window.location.href = "/";
            }
          })
          .catch((error) => {
            console.log(error);
          });
      }
    </script>
  </body>
</html>
